# Ebon Tide: Android Plugin Setup Guide

## Overview

This game requires two Android plugins for monetization:
1. **Godot AdMob Plugin** (poing-studios) — banner, interstitial, and rewarded ads
2. **Godot Google Play Billing Plugin** (official) — Ebon Pass IAP

Both plugins provide Engine singletons that the game's autoload scripts
(`AdsManager` and `EbonPass`) detect at runtime. On non-Android platforms
(editor, desktop), the singletons won't exist and all monetization calls
gracefully no-op.

---

## 1. AdMob Plugin Setup

### Plugin Info
- **Repository:** https://github.com/poing-studios/godot-admob-android
- **Minimum version:** v3.0.0+ (for Godot 4.x)
- **Engine singleton name:** `AdMob`

### Installation

1. Download the latest release `.zip` from the GitHub releases page.

2. Extract and copy the plugin folder into your project:
   ```
   res://android/plugins/
   ├── GodotAdMob.gdap
   ├── GodotAdMob.aar
   └── (any additional .aar dependencies)
   ```

3. In the Godot editor, go to **Project > Export > Android** and:
   - Enable **Use Gradle Build** (required for all Android plugins)
   - Under **Plugins**, check the box for **GodotAdMob**

4. Edit `android/build/AndroidManifest.xml` (generated by Godot on first
   Android export) and add your AdMob App ID inside `<application>`:
   ```xml
   <!-- REPLACE with your real AdMob App ID from https://admob.google.com -->
   <meta-data
       android:name="com.google.android.gms.ads.APPLICATION_ID"
       android:value="ca-app-pub-3940256099942544~3347511713"/>
   ```
   The value above is Google's **test App ID**. Replace before release.

5. The ad unit IDs are in `scripts/ads_manager.gd` (constants at the top):
   ```
   BANNER_ID        — currently set to Google test banner
   INTERSTITIAL_ID  — currently set to Google test interstitial
   REWARDED_ID      — currently set to Google test rewarded
   ```
   **Replace all three with your real AdMob unit IDs before release.**

### Test IDs (currently in use)
| Type          | Test ID                                    |
|---------------|--------------------------------------------|
| App ID        | `ca-app-pub-3940256099942544~3347511713`   |
| Banner        | `ca-app-pub-3940256099942544/6300978111`   |
| Interstitial  | `ca-app-pub-3940256099942544/1033173712`   |
| Rewarded      | `ca-app-pub-3940256099942544/5224354917`   |

---

## 2. Google Play Billing Plugin Setup

### Plugin Info
- **Repository:** https://github.com/godotengine/godot-google-play-billing
- **Minimum version:** v2.1.0+ (for Godot 4.x, Play Billing Library 6.x)
- **Engine singleton name:** `GodotGooglePlayBilling`

### Installation

1. Download the latest release `.zip` from the GitHub releases page.

2. Extract and copy into your project:
   ```
   res://android/plugins/
   ├── GodotGooglePlayBilling.gdap
   └── GodotGooglePlayBilling.aar
   ```

3. In the Godot editor, go to **Project > Export > Android** and:
   - Under **Plugins**, check the box for **GodotGooglePlayBilling**

4. In the **Google Play Console**, create the in-app product:
   - **Product ID:** `ebon_pass_monthly`
   - **Type:** Non-consumable (Managed product)
   - **Price:** $6.99 (or your chosen price point)
   - **Title:** Ebon Pass
   - **Description:** Remove all ads and unlock the daily Marks cache

   Note: The product ID `ebon_pass_monthly` is defined in
   `scripts/ebon_pass.gd` as the `PRODUCT_ID` constant.

### Purchase Flow
The `EbonPass` autoload handles the full purchase lifecycle:
- `EbonPass.purchase()` — initiates Google Play purchase flow
- `EbonPass.restore()` — queries previous purchases (reinstall recovery)
- Purchase state persists via `GameData.ebon_pass_active` in the save file

---

## 3. Autoload Registration

Add these lines to `project.godot` under the `[autoload]` section,
**after** the existing autoloads:

```ini
EbonPass="*res://scripts/ebon_pass.gd"
AdsManager="*res://scripts/ads_manager.gd"
```

**Load order matters:** `GameData` must load before `EbonPass`, and
`EbonPass` must load before `AdsManager`.

The full `[autoload]` section should look like:
```ini
[autoload]

GameData="*res://scripts/game_data.gd"
UITheme="*res://scripts/ui_theme.gd"
AudioManager="*res://scripts/audio_manager.gd"
SettingsPanel="*res://scripts/settings_panel.gd"
EbonPass="*res://scripts/ebon_pass.gd"
AdsManager="*res://scripts/ads_manager.gd"
```

---

## 4. Final Directory Structure

After setup, your `android/plugins/` directory should contain:
```
android/
└── plugins/
    ├── GodotAdMob.gdap
    ├── GodotAdMob.aar
    ├── GodotGooglePlayBilling.gdap
    └── GodotGooglePlayBilling.aar
```

---

## 5. Ebon Pass Economy: Sovereign Cache

When the Ebon Pass is active, players receive a daily free currency grant
called the **Sovereign Cache**:

- **Amount:** 100 Marks per collection
- **Interval:** Once every 24 hours
- **Stacking:** None — only one collection per cooldown, no accumulation
- **Collection:** Via the Black Market carousel (Ebon Pass item) or
  automatically on app launch

100 Marks/day is roughly one run's worth of earnings, giving pass holders
a daily head start without flooding the economy.

---

## 6. Ad Behavior Summary

| Ad Type       | Trigger                                | Ebon Pass |
|---------------|----------------------------------------|-----------|
| Banner        | Main menu only (auto-show/hide)        | Suppressed |
| Interstitial  | Every 3rd death                        | Suppressed |
| Rewarded      | "Watch Ad" in Black Market & death UI  | Suppressed |

All ad calls flow through `AdsManager`, which checks
`EbonPass.is_active()` before every operation. If the pass is active,
all methods silently return without loading or showing any ads.

---

## 7. Troubleshooting

- **Ads not showing in editor:** Expected. AdMob only works on Android
  devices/emulators. The autoloads print fallback messages to the console.
- **"GodotGooglePlayBilling not available":** The billing plugin requires
  a real Android build with Google Play Services. Test on a physical device.
- **Purchase not acknowledged:** The `EbonPass` script auto-acknowledges
  purchases in `_on_purchases_updated()`. If this fails, the purchase will
  be refunded by Google after 3 days.
- **Save migration:** Old saves without `ebon_pass_active` will default to
  `false` on load — no migration needed.
